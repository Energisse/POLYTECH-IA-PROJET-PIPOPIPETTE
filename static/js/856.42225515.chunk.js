(()=>{"use strict";var t={5856:(t,e,s)=>{class i{constructor(t){this.cells=[],this.verticals=[],this.horizontals=[],this.previousBoard=null,this.score=[0,0],this.tour=0,"number"===typeof t?(this.cells=new Array(t).fill(0).map((()=>new Array(t).fill(-1))),this.verticals=new Array(t).fill(0).map((()=>new Array(t+1).fill(-1))),this.horizontals=new Array(t+1).fill(0).map((()=>new Array(t).fill(-1))),this.score=[0,0],this.tour=0):(this.cells=t.cells,this.verticals=t.verticals,this.horizontals=t.horizontals,this.score=t.score,this.tour=t.tour,this.previousBoard=t.previousBoard||null)}getCells(){return this.cells}getVerticals(){return this.verticals}getHorizontals(){return this.horizontals}getScore(){return this.score}getWinner(){return this.score[0]>this.cells.length**2/2?0:this.score[1]>this.cells.length**2/2?1:null}getTour(){return this.tour}play(t,e,s){const o=this.horizontals.map((t=>[...t])),n=this.verticals.map((t=>[...t])),r=this.cells.map((t=>[...t])),l=[...this.score];let a=this.tour;if("vertical"===t){if(-1!==n[s][e])throw new Error("Invalid move");n[s][e]=this.tour}else{if(-1!==o[s][e])throw new Error("Invalid move");o[s][e]=this.tour}const h=[];if("horizontal"===t){let t=this.check(o,n,e,s);t&&h.push(t),t=this.check(o,n,e,s-1),t&&h.push(t)}else{let t=this.check(o,n,e,s);t&&h.push(t),t=this.check(o,n,e-1,s),t&&h.push(t)}return h.length?(l[a]+=h.length,h.forEach((t=>{r[t[1]][t[0]]=a}))):a=1===a?0:1,new i({cells:r,verticals:n,horizontals:o,score:l,tour:a,previousBoard:this})}isFinished(){return this.score[0]>this.cells.length**2/2||this.score[1]>this.cells.length**2/2||this.score[0]+this.score[1]===this.cells.length**2}check(t,e,s,i){var o;return!(s<0||s>=this.cells.length||i<0||i>=this.cells.length)&&(-1!==e[i][s]&&-1!==e[i][s+1]&&-1!==t[i][s]&&-1!==(null===(o=t[i+1])||void 0===o?void 0:o[s])&&[s,i])}evaluation(t){return this.score[t]-this.score[1===t?0:1]}*getNodes(){const t=[...this.verticals.flatMap(((t,e)=>t.map(((t,s)=>({x:s,y:e,value:t,orientation:"vertical"}))))).filter((t=>{let{value:e}=t;return-1===e})),...this.horizontals.flatMap(((t,e)=>t.map(((t,s)=>({x:s,y:e,value:t,orientation:"horizontal"}))))).filter((t=>{let{value:e}=t;return-1===e}))];for(;t.length>0;){const{x:e,y:s,orientation:i}=t.splice(Math.floor(Math.random()*t.length),1)[0],o=this.play(i,e,s);if(o.tour!==o.previousBoard.tour||o.isFinished())yield{x:e,y:s,board:o,orientation:i};else for(const t of o.getNodes())yield{...t,x:e,y:s,orientation:i}}}}class o{constructor(t,e,s,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.wins=void 0,this.visits=void 0,this.nodes=void 0,this.parent=void 0,this.board=void 0,this.player=void 0,this.simulation=void 0,this.c=void 0,this.generator=void 0,this.wins=0,this.visits=0,this.nodes=new Map,this.parent=o,this.generator=t.getNodes(),this.board=t,this.simulation=s,this.player=e,this.c=i}run(){if(this.board.isFinished()){for(let t=0;t<this.simulation;t++)this.backpropagation(this.simulate());return}let t=this.expansion();if(t)for(let e=0;e<this.simulation;e++)t.backpropagation(t.simulate());else{const{bestNode:t}=this.selection();t.run()}}selection(){let t=null,e=0,s=0,i="vertical",o=-1/0;return this.nodes.forEach(((n,r)=>{n.forEach(((n,l)=>{n.forEach(((n,a)=>{const h=n.wins/n.visits+this.c*Math.sqrt(2*Math.log(this.visits)/n.visits);h>o&&(o=h,i=r,e=+l,s=+a,t=n)}))}))})),{bestNode:t,x:e,y:s,orientation:i}}simulate(){let t=this.board.getNodes(),e=this.board;for(let s of t)e=e.play(s.orientation,s.x,s.y);return e.getWinner()===this.player}expansion(){const{value:t,done:e}=this.generator.next();if(e)return!1;const{orientation:s,x:i,y:n,board:r}=t,l=new o(r,this.player,this.simulation,this.c,this);let a=this.nodes.get(s);a||(a=new Map,this.nodes.set(s,a));let h=a.get(i);return h||(h=new Map,a.set(i,h)),h.set(n,l),l}backpropagation(t){t&&this.wins++,this.visits++,this.parent&&this.parent.backpropagation(t)}getBestChild(){let t=null,e=0,s=0,i="vertical",o=-1/0;return this.nodes.forEach(((n,r)=>{n.forEach(((n,l)=>{n.forEach(((n,a)=>{const h=n.wins/n.visits;h>o&&(i=r,e=+l,s=+a,o=h,t=n)}))}))})),{bestNode:t,x:e,y:s,orientation:i}}getNumberVisited(){return this.visits}}class n extends EventTarget{constructor(){super(...arguments),this.totalTime=0,this.totalMove=0,this.times=[]}}class r extends n{play(t,e){return new Promise((t=>{const s=performance.now();this.addEventListener("play",(i=>{const o=performance.now();this.totalTime+=o-s,this.totalMove++,this.times.push(o-s),console.log(`Player ${e} (${this.constructor.name}) Time: ${o-s} Average time: ${this.totalTime/this.totalMove}ms`);t(i.detail)}),{once:!0})}))}}class l extends n{async play(t,e){return(await Promise.all([(async()=>{const s=performance.now(),i=await this.playIa(t,e),o=performance.now();return this.totalTime+=o-s,this.totalMove++,this.times.push(o-s),console.log(`Player ${e} (${this.constructor.name}) Time: ${o-s} Average time: ${this.totalTime/this.totalMove}ms`),i})(),new Promise((t=>{setTimeout((()=>{t()}),500)}))]))[0]}}class a extends l{constructor(t){let{iteration:e,simulation:s,c:i}=t;super(),this.iteration=void 0,this.simulation=void 0,this.c=void 0,this.lastBoard=null,this.lastNode=null,this.iteration=e,this.simulation=s,this.c=i||Math.sqrt(2)}playIa(t,e){return new Promise((s=>{let i=null;if(this.lastBoard&&this.lastNode){const e=this.lastBoard.getHorizontals().flatMap(((e,s)=>e.map(((e,i)=>-1===e&&-1!==t.getHorizontals()[s][i]?{x:i,y:s,orientation:"horizontal"}:null)))).filter((t=>t)).concat(this.lastBoard.getVerticals().flatMap(((e,s)=>e.map(((e,i)=>-1===e&&-1!==t.getVerticals()[s][i]?{x:i,y:s,orientation:"vertical"}:null)))).filter((t=>t)));0===e.length&&(i=this.lastNode);let s=-1/0;if(e.length>0)for(const t of function(t){let e=[];function s(t,i){if(0===t.length)e.push(i.slice());else for(let e=0;e<t.length;e++){let o=t.slice(),n=o.splice(e,1);s(o,i.concat(n))}}return s(t,[]),e}(e)){var n,r;let e=(null===(n=this.lastNode.nodes.get(t[0].orientation))||void 0===n||null===(r=n.get(t[0].x))||void 0===r?void 0:r.get(t[0].y))||null;for(let s=1;s<t.length;s++){var l,a,h;if(e=(null===(l=e)||void 0===l||null===(a=l.nodes.get(t[s].orientation))||void 0===a||null===(h=a.get(t[s].x))||void 0===h?void 0:h.get(t[s].y))||null,!e)break}e&&e.wins>s&&(s=e.wins,i=e)}}let c=i||new o(t,e,this.simulation,this.c);for(;c.getNumberVisited()<this.iteration*this.simulation;)c.run();this.dispatchEvent(new CustomEvent("tree",{detail:c}));let u=c.getBestChild();this.lastNode=u.bestNode,this.lastBoard=t.play(u.orientation,u.x,u.y),s({x:u.x,y:u.y,orientation:u.orientation})}))}}class h extends l{playIa(t,e){return new Promise((e=>{const{orientation:s,x:i,y:o}=t.getNodes().next().value;e({x:i,y:o,orientation:s})}))}}class c extends l{constructor(t){let{depth:e}=t;super(),this.depth=void 0,this.depth=e}playIa(t,e){return new Promise((s=>{const{nodes:i,...o}=function(t,e,s,i){let o=0,n=0,r="vertical",l=0;const a=function t(s,a,h){if(0===a||s.isFinished())return s.evaluation(i)*(h?1:-1);let c=-1/0;for(const{board:i,x:u,y:d,orientation:p}of s.getNodes()){l++;const s=t(i,a-1,!h);-s>c&&(a===e&&(o=u,n=d,r=p),c=-s)}return c}(t,e,s);return{x:o,y:n,orientation:r,value:a,nodes:l}}(t,this.depth,!0,e);console.log(`Player ${e} (${this.constructor.name}) : ${i} nodes`),s(o)}))}}class u extends l{constructor(t){let{depth:e}=t;super(),this.depth=void 0,this.depth=e}playIa(t,e){return new Promise((s=>{const{nodes:i,...o}=function(t,e,s,i){let o=0,n=0,r="vertical",l=0;const a=function t(s,a,h){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;if(0===a||s.isFinished())return s.evaluation(i)*(h?1:-1);let d=-1/0;for(const{board:i,x:p,y:v,orientation:g}of s.getNodes()){l++;const s=t(i,a-1,!h,-u,-c);if(-s>d&&(d=-s,a===e&&(o=p,n=v,r=g)),d>=u)return d;c=Math.max(c,d)}return d}(t,e,s,arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1/0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0);return{value:a,x:o,y:n,orientation:r,nodes:l}}(t,this.depth,!0,e);console.log(`Player ${e} (${this.constructor.name}) : ${i} nodes`),s(o)}))}}console.log=()=>{},self.addEventListener("message",(t=>{let e,{data:{board:s,player:o,type:n}}=t;switch(n){case"human":e=new r;break;case"random":e=new h;break;case"minimax":e=new c({depth:3});break;case"alphabeta":e=new u({depth:3});break;case"mcts":e=new a({iteration:1e3,c:1.41,simulation:10});break;default:throw new Error("Invalid player type")}e.play(new i(s),o).then((t=>{self.postMessage(t)}))}))}},e={};e.m=t,e.u=t=>"static/js/"+t+".42225515.chunk.js",e.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),e.p="/POLYTECH-IA-PROJET-PIPOPIPETTE/",e.b=self.location+"/../../../";t[5856](0,{},e)})();
//# sourceMappingURL=856.42225515.chunk.js.map