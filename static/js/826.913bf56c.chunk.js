(()=>{"use strict";var t={m:{},u:t=>"static/js/"+t+".b0a74d55.chunk.js",o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),p:"/Energisse/POLYTECH-IA-PROJET-PIPOPIPETTE.git/"};t.b=self.location+"/../../../";class e extends EventTarget{constructor(t,e,i){super(),this.board=void 0,this.players=void 0,this.board=new s(t),this.players=[e,i],this.play()}async play(){await this.players[this.board.getTour()-1].play(this.board,this.board.getTour()-1).then((t=>{this.board.play(t.orientation,t.x,t.y),this.board.isFinished()||this.play()}))}}class s extends EventTarget{constructor(t){super(),this.cells=[],this.verticals=[],this.horizontals=[],this.score=[0,0],this.tour=1,"number"===typeof t?(this.cells=new Array(t).fill(0).map((()=>new Array(t).fill(0))),this.verticals=new Array(t).fill(0).map((()=>new Array(t+1).fill(0))),this.horizontals=new Array(t+1).fill(0).map((()=>new Array(t).fill(0))),this.score=[0,0],this.tour=1):(this.cells=t.cells,this.verticals=t.verticals,this.horizontals=t.horizontals,this.score=t.score,this.tour=t.tour)}getCells(){return this.cells}getVerticals(){return this.verticals}getHorizontals(){return this.horizontals}getScore(){return this.score}getTour(){return this.tour}play(t,e,s){if("vertical"===t){if(0!==this.verticals[s][e])return;this.verticals[s][e]=this.tour}else{if(0!==this.horizontals[s][e])return;this.horizontals[s][e]=this.tour}const i=[];if("horizontal"===t){let t=this.check(e,s);t&&i.push(t),t=this.check(e,s-1),t&&i.push(t)}else{let t=this.check(e,s);t&&i.push(t),t=this.check(e-1,s),t&&i.push(t)}if(i.length?(this.score[this.tour-1]+=i.length,i.forEach((t=>{this.cells[t[1]][t[0]]=this.tour}))):this.tour=1===this.tour?2:1,this.dispatchEvent(new CustomEvent("boardChange",{detail:{verticals:this.verticals,horizontals:this.horizontals,cells:this.cells,score:this.score}})),this.isFinished()){const t=this.score[0]===this.score[1]?0:this.score[0]>this.score[1]?1:2;this.dispatchEvent(new CustomEvent("end",{detail:{winner:t}}))}}isFinished(){return this.score[0]>this.cells.length**2/2||this.score[1]>this.cells.length**2/2||this.score[0]+this.score[1]===this.cells.length**2}check(t,e){var s;return!(t<0||t>=this.cells.length||e<0||e>=this.cells.length)&&(!!(this.verticals[e][t]&&this.verticals[e][t+1]&&this.horizontals[e][t]&&null!==(s=this.horizontals[e+1])&&void 0!==s&&s[t])&&[t,e])}evaluation(t){return this.score[t]-this.score[(t+1)%2]}copy(){const t=new s(this.cells.length);return t.cells=this.cells.map((t=>[...t])),t.verticals=this.verticals.map((t=>[...t])),t.horizontals=this.horizontals.map((t=>[...t])),t.score=[...this.score],t.tour=this.tour,t}*getNodesVertical(){const t=this.verticals.flatMap(((t,e)=>t.map(((t,s)=>({x:s,y:e,value:t}))))).filter((t=>{let{value:e}=t;return 0===e}));for(;t.length>0;){const{x:e,y:s}=t.splice(Math.floor(Math.random()*t.length),1)[0],i=this.copy(),r=i.tour;if(i.play("vertical",e,s),i.tour!==r||i.isFinished())yield{x:e,y:s,board:i,orientation:"vertical"};else for(const t of i.getNodes())yield{...t,x:e,y:s,orientation:"vertical"}}}*getNodesHorizontal(){const t=this.horizontals.flatMap(((t,e)=>t.map(((t,s)=>({x:s,y:e,value:t}))))).filter((t=>{let{value:e}=t;return 0===e}));for(;t.length>0;){const{x:e,y:s}=t.splice(Math.floor(Math.random()*t.length),1)[0],i=this.copy(),r=i.tour;if(i.play("horizontal",e,s),i.tour!==r||i.isFinished())yield{x:e,y:s,board:i,orientation:"horizontal"};else for(const t of i.getNodes())yield{...t,x:e,y:s,orientation:"horizontal"}}}*getNodes(){const t=this.getNodesVertical(),e=this.getNodesHorizontal();let s=!1,i=!1;for(;!s&&!i;)if(Math.random()<.5){const{value:e,done:s}=t.next();s?i=!0:yield e}else{const{value:t,done:i}=e.next();i?s=!0:yield t}if(!s)for(const r of e)yield r;if(!i)for(const r of t)yield r}}class i{constructor(t,e,s,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.wins=void 0,this.visits=void 0,this.nodes=void 0,this.parent=void 0,this.board=void 0,this.player=void 0,this.simulation=void 0,this.c=void 0,this.generator=void 0,this.wins=0,this.visits=0,this.nodes=new Map,this.parent=r,this.generator=t.getNodes(),this.board=t,this.simulation=s,this.player=e,this.c=i}run(){if(this.board.isFinished()){for(let t=0;t<this.simulation;t++)this.backpropagation(this.simulate());return}let t=this.expansion();if(t)for(let e=0;e<this.simulation;e++)t.backpropagation(t.simulate());else{const{bestNode:t}=this.selection();t.run()}}selection(){let t=null,e=0,s=0,i="vertical",r=-1/0;return this.nodes.forEach(((o,n)=>{o.forEach(((o,a)=>{o.forEach(((o,l)=>{const h=o.wins/o.visits+this.c*Math.sqrt(2*Math.log(this.visits)/o.visits);h>r&&(r=h,i=n,e=+a,s=+l,t=o)}))}))})),{bestNode:t,x:e,y:s,orientation:i}}simulate(){let t,e=this.board.getNodes().next();for(;!e.done;)t=e.value.board,e=e.value.board.getNodes().next();return!!t&&t.getScore()[this.player]>t.getScore()[1===this.player?0:1]}expansion(){const{value:t,done:e}=this.generator.next();if(e)return!1;const{orientation:s,x:r,y:o,board:n}=t,a=new i(n,this.player,this.simulation,this.c,this);let l=this.nodes.get(s);l||(l=new Map,this.nodes.set(s,l));let h=l.get(r);return h||(h=new Map,l.set(r,h)),h.set(o,a),a}backpropagation(t){t&&this.wins++,this.visits++,this.parent&&this.parent.backpropagation(t)}getBestChild(){let t=null,e=0,s=0,i="vertical",r=-1/0;return this.nodes.forEach(((o,n)=>{o.forEach(((o,a)=>{o.forEach(((o,l)=>{const h=o.wins/o.visits;h>r&&(i=n,e=+a,s=+l,r=h,t=o)}))}))})),{bestNode:t,x:e,y:s,orientation:i}}getNumberVisited(){return this.visits}}function r(t,e,s,i){if(0===e||t.isFinished())return{x:0,y:0,orientation:"vertical",value:t.evaluation(i)*(s?1:-1)};let o=-1/0,n=-1,a=-1,l="vertical";for(const{board:h,x:c,y:d,orientation:u}of t.getNodes()){const{value:t}=r(h,e-1,!s,i);-t>o&&(o=-t,n=c,a=d,l=u)}return{x:n,y:a,value:o,orientation:l}}function o(t,e,s,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1/0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;if(0===e||t.isFinished())return{x:0,y:0,orientation:"vertical",value:t.evaluation(i)*(s?1:-1)};let a=-1/0,l=-1,h=-1,c="vertical";for(const{board:d,x:u,y:p,orientation:v}of t.getNodes()){const{value:t}=o(d,e-1,!s,i,-n,-r);if(-t>a&&(a=-t,l=u,h=p,c=v),a>=n)return{x:l,y:h,orientation:c,value:a};r=Math.max(r,a)}return{x:l,y:h,orientation:c,value:a}}class n extends EventTarget{}class a extends n{play(t,e){return new Promise((t=>{this.addEventListener("play",(e=>{t(e.detail)}),{once:!0})}))}}class l extends n{async play(t,e){return(await Promise.all([(async()=>{const s=performance.now(),i=await this.playIa(t,e),r=performance.now();return console.log("Player ".concat(e," (").concat(this.constructor.name,") Time to play: ").concat(r-s,"ms")),i})(),new Promise((t=>{setTimeout((()=>{t()}),500)}))]))[0]}}class h extends l{constructor(t){let{iteration:e,simulation:s,c:i}=t;super(),this.iteration=void 0,this.simulation=void 0,this.c=void 0,this.iteration=e,this.simulation=s,this.c=i||Math.sqrt(2)}playIa(t,e){return new Promise((s=>{let r=new i(t,e,this.simulation,this.c);for(;r.getNumberVisited()<this.iteration*this.simulation;)r.run();this.dispatchEvent(new CustomEvent("tree",{detail:r}));let o=r.getBestChild();s({x:o.x,y:o.y,orientation:o.orientation})}))}}class c extends l{playIa(t,e){return new Promise((e=>{const{orientation:s,x:i,y:r}=t.getNodes().next().value;e({x:i,y:r,orientation:s})}))}}class d extends l{constructor(t){let{depth:e}=t;super(),this.depth=void 0,this.depth=e}playIa(t,e){return new Promise((s=>{s(r(t,this.depth,!0,e))}))}}class u extends l{constructor(t){let{depth:e}=t;super(),this.depth=void 0,this.ias=["minimax","alphabeta","mcts"],this.depth=e}playIa(e,s){const i=[];return Promise.race(this.ias.map((r=>new Promise((o=>{const n=new Worker(new URL(t.p+t.u(472),t.b));i.push(n),n.postMessage({board:JSON.parse(JSON.stringify(e)),depth:this.depth,player:s,type:r}),n.addEventListener("message",(t=>{o([t.data,r])}))}))))).then((t=>{let[e,s]=t;return i.forEach((t=>t.terminate())),console.log(s),e}))}}class p extends l{constructor(t){let{depth:e}=t;super(),this.depth=void 0,this.depth=e}playIa(t,e){return new Promise((s=>{s(o(t,this.depth,!0,e))}))}}DedicatedWorkerGlobalScope.prototype.emit=function(){this.postMessage({type:arguments.length<=0?void 0:arguments[0],data:arguments.length<=1?void 0:arguments[1]})},self.addEventListener("message",(t=>{let{data:{data:e,type:s}}=t;self.dispatchEvent(new CustomEvent(s,{detail:e}))}));let v=null;function y(t){const e=new Array;return t.nodes.forEach(((t,s)=>{t.forEach(((t,s)=>{t.forEach(((t,s)=>{e.push(y(t))}))}))})),{name:"".concat(t.wins,"/").concat(t.visits),children:e}}function f(t){switch(t.type){case"human":return new a;case"random":return new c;case"minimax":return new d(t);case"alphabeta":return new p(t);case"mcts":return new h(t);case"fastest":return new u(t)}}self.addEventListener("start",(t=>{let{detail:{player1:s,player2:i,size:r}}=t;if(v)return;const o=f(s),n=f(i);o.addEventListener("tree",(t=>{self.emit("tree",{player:1,tree:y(t.detail)})})),n.addEventListener("tree",(t=>{self.emit("tree",{player:2,tree:y(t.detail)})})),v=new e(r,o,n),o instanceof a&&self.addEventListener("play",(t=>{o.dispatchEvent(new CustomEvent("play",{detail:t.detail}))})),n instanceof a&&self.addEventListener("play",(t=>{n.dispatchEvent(new CustomEvent("play",{detail:t.detail}))})),self.emit("change",{verticals:v.board.getVerticals(),horizontals:v.board.getHorizontals(),score:v.board.getScore(),tour:v.board.getTour(),cells:v.board.getCells()}),v.board.addEventListener("end",(t=>{const{winner:e}=t.detail;self.emit("end",{winner:e})})),v.board.addEventListener("boardChange",(t=>{const{verticals:e,horizontals:s,cells:i}=t.detail;self.emit("change",{verticals:e,horizontals:s,score:v.board.getScore(),tour:v.board.getTour(),cells:i})}))}))})();
//# sourceMappingURL=826.913bf56c.chunk.js.map